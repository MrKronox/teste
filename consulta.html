<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Escalas - Boa Vista</title>
    <style>


        .logo-header { 
                width: 140px; 
                margin-bottom: 10px; 
                filter: brightness(0) invert(1);
            }

        .header-app { 
            width: 100%;
            margin: 0; /* Remova qualquer margem negativa ou positiva */
            padding: 30px 10px; 
            background: linear-gradient(135deg, #002e5d 0%, #004a99 100%); 
            color: white; 
            border-radius: 0 0 30px 30px;
            text-align: center;
            position: relative;
            box-sizing: border-box;
            
        }

        .side-controls {
            position: absolute; 
            top: 15px; 
            right: 15px;
            display: flex; 
            flex-direction: column;
            gap: 8px;
            align-items: center;
        }

        .btn-control {
            width: 38px; 
            height: 38px;
            background: rgba(255, 255, 255, 0.15); 
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3); 
            border-radius: 10px;
            display: flex; 
            align-items: center; 
            justify-content: center;
            cursor: pointer; 
            backdrop-filter: blur(4px);
            text-decoration: none; 
            transition: 0.2s;
        }

        .btn-control:hover {
            background: rgba(255, 255, 255, 0.25); 
            transform: translateY(-2px); 
        }

        .by-header { 
            font-size: 0.7em; 
            opacity: 0.8; 
            margin-top: 5px; 
            font-weight: 300; 
            letter-spacing: 1px;
            text-transform: lowercase; 
        }
        :root {
            --primary: #002e5d; 
            --bg: #f4f7f6; 
            --white: #ffffff; 
            --text: #2f3640; 
            --border: #dee2e6;
            --accent: #d35400;
            --input-bg: #f8f9fa;
        }

        body.dark-mode {
        --bg: #0f172a;
        --white: #1e293b;
        --text: #f1f5f9;
        --border: #334155;
        --input-bg: #0f172a;
        --primary: #60a5fa;
        --accent: #fbbf24;
        }

        body.dark-mode .input-group label { color: var(--primary); }
        body.dark-mode .btn-voltar { color: var(--primary); }
        body.dark-mode .stats { color: var(--text); }
        body.dark-mode .placeholder-msg { color: #94a3b8; }
        body.dark-mode tbody td { border-bottom: 1px solid var(--border); }

        body.dark-mode input {
            background-color: var(--white);
            color: var(--text);
            border-color: var(--border);
        }

        body { 
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
        }
        
        .container { 
            max-width: 900px;
            margin: 0 auto;
            padding: 20px 15px; 
        }

        .side-controls {
            position: absolute; 
            top: 15px; 
            right: 15px;
            display: flex; 
            flex-direction: column; 
            gap: 8px;
            align-items: center;
        }

        .btn-control {
            width: 38px; 
            height: 38px;
            background: rgba(255, 255, 255, 0.15); 
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3); 
            border-radius: 10px;
            display: flex; 
            align-items: center; 
            justify-content: center;
            cursor: pointer; 
            backdrop-filter: blur(4px);
            text-decoration: none; 
            transition: 0.2s;
        }

        .btn-control:hover { 
            background: rgba(255, 255, 255, 0.25); 
            transform: translateY(-2px); 
        }

        .btn-voltar {
            display: inline-block;
            margin: 10px 0 20px 0; /* Adicionado margem superior */
            text-decoration: none;
            color: var(--primary);
            font-weight: bold;
            font-size: 0.9em;
            transition: 0.2s;
        }

        .btn-voltar:hover { opacity: 0.8; }

        .by-header { 
            font-size: 0.7em; 
            opacity: 0.8; 
            margin-top: 8px; 
            font-weight: 300; 
            letter-spacing: 1px; 
        }
    
        body.dark-mode .by-header { color: #cbd5e1; opacity: 1; }

        /* Barra de Busca Responsiva */
        .search-box {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
            background: var(--input-bg);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid var(--border);
        }

        @media (min-width: 768px) {
            .search-box {
                flex-direction: row;
                align-items: flex-end; /* Alinha o bot√£o com a base dos inputs */
            }
            .input-group { flex: 1; }
        }

        .input-group label {
            display: block;
            font-size: 0.85em;
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--primary);
        }

        input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 16px;
            box-sizing: border-box;
            outline: none;
        }

        .btn-limpar, .btn-voltar {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            color: #444;
            border-radius: 999px;
            cursor: pointer;
            transition: all 0.25s ease;
            border: 1px solid rgba(255, 255, 255, 0.7);
            text-decoration: none;
            background: linear-gradient(180deg, #fcfcfc, #e8eced);
            box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.05), 
                -1px -1px 10px rgba(255, 255, 255, 0.8);
        }

        .btn-limpar:active, .btn-voltar:active {
             box-shadow: inset 3px 3px 6px rgba(0, 0, 0, 0.1), 
                inset -3px -3px 6px rgba(255, 255, 255, 0.8);
            transform: scale(0.98);
            }

        .btn-limpar:hover { background: #e0e0e0; transform: translateY(-1px); }

        body.dark-mode .btn-limpar {
            background: rgba(231, 76, 60, 0.1); /* Um fundo vermelho bem sutil */
            border: 1px solid #e74c3c; /* Borda vermelha para dar destaque */
            color: #ff7675; /* Texto em tom de coral/vermelho claro */
        }

        body.dark-mode .btn-limpar:hover {
            background: #e74c3c; /* Fica vermelho s√≥lido ao passar o mouse */
            color: white;
        }

        .table-container {
            width: 100%;
            overflow-x: auto;
        }

        table { width: 100%; border-collapse: collapse; min-width: 500px; }
        
        thead th { 
            background: var(--primary); 
            color: white; 
            padding: 12px; 
            text-align: left;
            font-size: 0.9em;
        }

        tbody td { 
            padding: 12px; 
            border-bottom: 1px solid #eee; 
            font-size: 0.9em;
        }
        
        .voluntario-nome { color: var(--accent); font-weight: bold; }

    

        .stats { margin-bottom: 10px; font-weight: 600; color: var(--primary); font-size: 0.85em; }

        .placeholder-msg {
            text-align: center;
            padding: 40px 20px;
            color: #7f8c8d;
        }

        /* Ajuste de Tabela Responsiva para n√£o quebrar o layout */
        .table-container {
            width: 100%;
            overflow-x: hidden; /* Evita que a p√°gina dance para os lados */
            margin-top: 20px;
        }

        table {
            width: 100%;
            table-layout: fixed; /* For√ßa a tabela a respeitar a largura da tela */
            border-collapse: collapse;
            background-color: var(--white);
        }

        /* No mobile, reduzimos a fonte e o espa√ßamento */
            
        @media (max-width: 600px) {
            /* 1. Removemos o cabe√ßalho azul para usar legendas internas */
            thead { display: none; }

            /* 2. O Card */
            #corpoTabela tr:active {
                background-color: #f0f0f0;
                transform: scale(0.98);
                transition: 0.1s;
                display: block;
                background: var(--white);
                margin-bottom: 12px;
                padding: 15px;
                border-radius: 10px;
                border: 1px solid var(--border);
                box-shadow: 0 2px 5px rgba(0,0,0,0.05);
                position: relative !important;
            }

            #corpoTabela td {
                display: block;
                width: 100% !important;
                border: none !important;
                padding: 4px 0 !important;
                position: relative;
            }

            /* 3. Estiliza√ß√£o dos Dados */
    
            /* Data e Dia lado a lado */
            #corpoTabela td:nth-child(1) {
                font-size: 15px;
                font-weight: 800;
                display: inline-block;
                width: auto !important;
                color: var(--text);
            }
            #corpoTabela td:nth-child(2) {
                font-size: 15px;
                font-weight: 700;
                display: inline-block;
                width: auto !important;
                margin-left: 10px;
                color: var(--primary);
            }

            /* Volunt√°rio com R√≥tulo Cinza */
            #corpoTabela td:nth-child(3) {
                margin-top: 10px;
                font-size: 14px;
                font-weight: 700;
                color: var(--secondary) !important;
            }
            #corpoTabela td:nth-child(3)::before {
                content: "VOLUNT√ÅRIO";
                display: block;
                font-size: 9px;
                color: #999;
                letter-spacing: 1px;
                margin-bottom: 2px;
            }

            /* Departamento (Badge Estilizado) */
            #corpoTabela td:nth-child(4) {
                margin-top: 12px;
                padding: 10px !important;
                background-color: rgba(0, 46, 93, 0.05); /* Tom leve do seu azul */
                border-radius: 6px;
                font-size: 12px;
                font-weight: 600;
                color: var(--text);
                display: flex;
                align-items: center;
                border-left: 4px solid var(--primary) !important;
            }
            #corpoTabela td:nth-child(4)::before {
                content: "DEPTO:";
                font-size: 9px;
                color: var(--primary);
                margin-right: 8px;
                font-weight: 800;
            }

            /* Ajuste de Dark Mode */
            body.dark-mode #corpoTabela tr {
                background: #1e1e1e;
            }
            body.dark-mode #corpoTabela td:nth-child(4) {
                background-color: rgba(255, 255, 255, 0.05);
            }
            .card-hoje {
                border-left: 8px solid #28a745 !important;
                background-color: #f8fff9 !important;
                position: relative !important; /* ISSO √â OBRIGAT√ìRIO para o selo aparecer */
                overflow: visible !important;  /* Garante que o selo n√£o suma nas bordas */
                z-index: 1;
            }

            /* Opcional: Adiciona um selo escrito "HOJE" no topo do card */
            .card-hoje::after {
                content: "HOJE";
                position: absolute;
                top: 12px;
                right: 12px;
                background-color: #28a745;
                color: #ffffff;
                font-size: 10px;
                font-weight: 900;
                padding: 4px 10px;
                border-radius: 4px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                display: block !important; /* Garante visibilidade */
                z-index: 99; /* Garante que fique por cima de tudo */
            }

            /* Ajuste para o Dark Mode n√£o ficar estranho */
            body.dark-mode .card-hoje {
                background-color: #1b2e1d !important;
                border-left-color: #2fb344 !important;
            }
        }
        /* se der errado trocar essa parte*/
        /* Container dos departamentos extras (escondido por padr√£o) */
.submenu-conflitos {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
    background: rgba(231, 76, 60, 0.05);
    border-radius: 0 0 10px 10px;
    margin: 0 -15px -15px -15px; /* Ajusta para preencher o card no mobile */
}

/* Quando o card for clicado, adicionaremos a classe 'aberto' via JS */
.card-escala.aberto .submenu-conflitos {
    max-height: 200px; /* Altura suficiente para os bal√µes */
    padding: 15px;
    border-top: 1px dashed #e74c3c;
}

/* Indicador visual de que h√° mais departamentos */
.badge-conflito-aviso {
    background: #e74c3c;
    color: white;
    font-size: 10px;
    padding: 2px 8px;
    border-radius: 10px;
    margin-left: 10px;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

/* Ajuste no card para parecer clic√°vel */
.card-escala {
    cursor: pointer;
    transition: transform 0.2s;
}

.card-escala:active {
    transform: scale(0.98);
}
    </style>
</head>

<body>

<div class="header-app no-capture">
    <div class="side-controls">
        <button class="btn-control btn-theme-toggle" onclick="toggleDarkMode()" title="Mudar Tema">üåì</button>
        <a href="https://www.instagram.com/boavista_iasd/" target="_blank" class="btn-control" title="Instagram">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.917 3.917 0 0 0-1.417.923A3.927 3.927 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.916 3.916 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.926 3.926 0 0 0-.923-1.417A3.911 3.911 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0h.003zm-.717 1.442h.718c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599.28.28.453.546.598.92.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.47 2.47 0 0 1-.599.919c-.28.28-.546.453-.92.598-.282.11-.705.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.478 2.478 0 0 1-.92-.598 2.48 2.48 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233 0-2.136.008-2.388.046-3.231.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92.28-.28.546-.453.92-.598.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045v.002zm4.988 1.328a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92zm-4.27 1.122a4.109 4.109 0 1 0 0 8.217 4.109 4.109 0 0 0 0-8.217zm0 1.441a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334z"/></svg>
        </a>
        <a href="https://www.youtube.com/@iasdgoiana" target="_blank" class="btn-control" title="YouTube">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M8.051 1.999h.089c.822.003 4.987.033 6.11.335a2.01 2.01 0 0 1 1.415 1.42c.101.38.172.883.22 1.402l.01.104.022.26.008.104c.065.914.073 1.77.074 1.957v.075c-.001.194-.01 1.108-.082 2.06l-.008.105-.009.104c-.05.572-.124 1.14-.235 1.558a2.007 2.007 0 0 1-1.415 1.42c-1.16.312-5.569.334-6.18.335h-.142c-.309 0-1.587-.006-2.927-.052l-.17-.006-.087-.004-.171-.007-.171-.007c-1.11-.049-2.367-.102-3.287-.348a2.007 2.007 0 0 1-1.415-1.419c-.111-.417-.185-.986-.235-1.558L.09 9.82l-.008-.104A31.4 31.4 0 0 1 0 7.68v-.123c.002-.215.01-.958.064-1.778l.007-.103.003-.052.008-.104.022-.26.01-.104c.048-.519.119-1.023.22-1.402a2.007 2.007 0 0 1 1.415-1.42c.487-.13 1.544-.21 2.654-.26l.17-.007.172-.006.086-.003.171-.007A99.788 99.788 0 0 1 7.858 2h.193zM6.4 5.209v4.818l4.157-2.408L6.4 5.209z"/></svg>
        </a>
    </div>
    <img src="https://identidade.adventistas.org/pt/assets/img/iasd_logo.svg" class="logo-header" alt="IASD">
    <h2 style="margin:0; font-size: 1.5em; font-weight: 800; letter-spacing: 1px; text-transform: uppercase; color: white">üîç CONSULTA DE VOLUNT√ÅRIOS</h2>
    <div class="by-header">by comunica√ß√£o boa vista</div>
</div>

<div class="container">
    <a href="index.html" class="btn-voltar">‚¨ÖÔ∏è Voltar ao Gerador</a>

    <div class="search-box">
        <div class="input-group">
            <label>üë§ Nome do Volunt√°rio</label>
            <input type="text" id="buscaNome" placeholder="Digite um nome..." onkeyup="realizarConsulta()">
        </div>
        <div class="input-group">
            <label>üìÖ Data Espec√≠fica</label>
            <input type="date" id="buscaData" onchange="realizarConsulta()">
        </div>
        <button onclick="limparBusca()" class="btn-limpar">üßπ Limpar</button>
    </div>

    <div id="resultadoConsulta">
        <div class="stats" id="contadorDias"></div>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Dia</th>
                        <th>Volunt√°rio(s)</th>
                        <th>Depto</th>
                    </tr>
                </thead>
                <tbody id="corpoTabela">
                    <tr>
                        <td colspan="4" class="placeholder-msg">
                            Digite um nome ou selecione uma data para pesquisar.
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
            // --- FUN√á√ÉO DE MODO ESCURO ---
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }
            // --- VERIFICADOR DE TEMA AO CARREGAR A P√ÅGINA ---
            document.addEventListener('DOMContentLoaded', () => {
            // Se o tema salvo for dark, aplica a classe imediatamente
            if (localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                }
            }
        );

        function realizarConsulta() {
    const nomeBusca = document.getElementById('buscaNome').value.trim().toLowerCase();
    const dataBusca = document.getElementById('buscaData').value;
    const corpo = document.getElementById('corpoTabela');
    const stats = document.getElementById('contadorDias');
    const hojeDataISO = new Date().toISOString().split('T')[0];

    if (!nomeBusca && !dataBusca) {
        corpo.innerHTML = `<tr><td colspan="4" class="placeholder-msg">Digite um nome ou selecione uma data para pesquisar.</td></tr>`;
        stats.innerText = "";
        return;
    }

    const escalas = JSON.parse(localStorage.getItem('banco_escalas_total')) || [];
    escalas.sort((a, b) => new Date(a.data) - new Date(b.data));

    const agrupado = {};

    escalas.forEach(item => {
        // --- LIMPEZA DE "SUJEIRA" NOS NOMES ---
        // 1. Remove emojis e par√™nteses
        let nomeLimpo = item.responsaveis.split('(')[0].replace('‚ö†Ô∏è', '').trim();
        
        // 2. Remove termos de departamentos que costumam "vazar" para o campo de nome
        const termosSujeira = ["especial", "congregacional", "louvor", "prega√ß√£o", "sonoplastia",":"];
        termosSujeira.forEach(termo => {
            const regex = new RegExp(termo, 'gi');
            nomeLimpo = nomeLimpo.replace(regex, '');
        });

        // 3. Remove espa√ßos duplos e limpa as pontas
        nomeLimpo = nomeLimpo.replace(/\s+/g, ' ').trim();

        if (!nomeLimpo || nomeLimpo.length < 2) return;

        const bateNome = nomeBusca === "" || nomeLimpo.toLowerCase().includes(nomeBusca);
        const bateData = dataBusca === "" || item.data === dataBusca;

        if (bateNome && bateData) {
            const chave = `${item.data}_${nomeLimpo.toLowerCase()}`;
            if (!agrupado[chave]) {
                agrupado[chave] = {
                    data: item.data,
                    diaSemana: item.diaSemana,
                    voluntario: nomeLimpo,
                    deptos: [item.depto]
                };
            } else {
                if (!agrupado[chave].deptos.includes(item.depto)) {
                    agrupado[chave].deptos.push(item.depto);
                }
            }
        }
    });

    corpo.innerHTML = "";
    const resultados = Object.values(agrupado);

    resultados.forEach(registro => {
        const dataFormatada = registro.data.split('-').reverse().join('/');
        const classeHoje = (registro.data === hojeDataISO) ? 'card-hoje' : '';
        const temConflito = registro.deptos.length > 1;

        const tr = document.createElement('tr');
        tr.className = `card-escala ${classeHoje}`;
        if (temConflito) {
            tr.onclick = function() { this.classList.toggle('aberto'); };
        }

        tr.innerHTML = `
            <td><strong>${dataFormatada}</strong></td>
            <td>${registro.diaSemana}</td>
            <td class="voluntario-nome">
                ${registro.voluntario}
                ${temConflito ? `<span class="badge-conflito-aviso">‚ö†Ô∏è +${registro.deptos.length - 1} escala</span>` : ''}
            </td>
            <td>
                <div class="depto-badge">${registro.deptos[0]}</div>
                ${temConflito ? `
                    <div class="submenu-conflitos">
                        <span class="titulo-outras-escalas">‚ö†Ô∏è CONFLITO DE ESCALA</span>
                        ${registro.deptos.slice(1).map(d => `<div class="depto-badge depto-alerta">${d}</div>`).join('')}
                    </div>
                ` : ''}
            </td>
        `;
        corpo.appendChild(tr);
    });

    stats.innerText = resultados.length ? `Encontrados ${resultados.length} registros.` : "";
    if (!resultados.length) corpo.innerHTML = `<tr><td colspan="4" class="placeholder-msg">Nenhum registro encontrado.</td></tr>`;
}
    
        function limparBusca() {
            document.getElementById('buscaNome').value = "";
            document.getElementById('buscaData').value = "";
            realizarConsulta();
            document.getElementById('buscaNome').focus();
        }
</script>

</body>
</html>
